# **GNAT Dynamic Analysis Suite** <br> ***Kickstart Workflow***

## Unit Test Development

Under the ***src*** subdirectory, an Ada package called ***Engines*** can be found.

It's package specification contains a single subprogram:

> function Stable (E : Engine) return Boolean;

along with a subprogram body:

> function Stable (E : Engine) return Boolean is<br>
> begin<br>
> &nbsp;&nbsp;&nbsp;&nbsp;return E.P < Stable_Engine_Data.P and then E.T < Stable_Engine_Data.T;<br>
> end Stable;

The remainder of this workflow centers around unit testing and MC/DC coverage analysis of the ***Stable*** subprogram.

Under the ***src\ut*** subdirectory, you will find the following Ada unit:

> engines-test_stable.adb

This subprogram makes several calls to *Engines.Stable*, on each occasion checking the returned data matches the expected result and if it completes all calls successfully, yields 100% MC/DC coverage of the subprogram under test. The *Engines-Test_Stable* subprogram can be called by a standalone main program, to develop the test and then from a GNATtest generated test harness to form part of a larger test and coverage campaign, both of which will now be outlined.

### Standalone Test Development

Alongside ***engines-test_stable.adb***, there is a second Ada unit in a subdirectory called ***standalone***: 

> standalone_test_runner.adb

A simple Ada main program designed to be a standalone test program runner which calls *Engines.Stable* and does nothing else. One can expand on this main subprogram to call as many test programs as one wishes, the point being it's flexible enough to permit the development of test subprograms, such as *Engines.Stable*.

Building the standalone test program runner is done using the following command line:

> ***gprbuild --implicit-with=aunit.gpr -g -p -P standalone.gpr -bargs -E***

An executable called ***standalone_test_runner*** will be built in the ***obj*** subdirectory, providing a simple development and debug cycle for ***engines-test_stable.adb***.

One can follow this pattern of developing and debugging additional standalone test programs, ready for reuse in an automated test and coverage campaign.

### Automated Test & Coverage Campaign

The GNAT Dynamic Analysis Suite provides the GNATtest component point tool which can be used to generate the required infrastructure for driving a test and coverage campaign.

***gnatdas.gpr*** contains the following snippet

>***Generated_Tests_Directory := Project'Project_Dir & "/verification/gnatdas/gnattest_tests";<br>
>package GNATtest is<br>
>&nbsp;&nbsp;&nbsp;for Tests_Dir use Generated_Tests_Directory;<br>
>&nbsp;&nbsp;&nbsp;for Harness_Dir use "gnattest";<br>
>&nbsp;&nbsp;&nbsp;for Skeletons_Default use "fail";<br>
>end GNATtest;***

Generate the test and coverage campaign infrastructure for our ***Engines*** package, using the following command line:

> ***gnattest -P gnatdas.gpr***

The output from which can be found in a number of subdirectories:

>.\verification\gnatdas\gnattest_tests

Contains test harness packages and subprograms to drive each of the public subprograms under test in the ***Engines*** package.

In particular, for ***Engines.Stable*** the test harness subprogram ***Engines.Test_Data.Tests.Test_Stable*** is where we place a call to our standalone test subprogram, ***engines-test_stable.adb***. A with statement for the standalone test subprogram will also be needed.

Please read the comments about read-only sections in any units produced by GNATtest to ensure user defined code is retained on futher invocations of GNATtest.

Please note until you change the body of ***Engines.Test_Data.Tests.Test_Stable***, it will automatically mark the test as failed, as directed by the ***Skeletons_Default*** attribute in ***gnatdas.gpr***. This offers a convenient way of assessing the remaining technical debt of unimplemented unit tests. 

It is expected that the contents of ***.\verification\gnatdas\gnattest_tests*** would be put under configuration control.

The next subdirectory written by GNATtest is:

>.\obj\gnattest

It contains all the autogenerated temporary components of the campagin build and shouldn't need to be user modified and will *not* be put under configuration control.

## Workflow Operation

> A Microsoft Windows host and PowerShell is required

A PowerShell script called gnatdas.ps1 is key to this workflow.

TBD
